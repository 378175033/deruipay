<!doctype html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>支付测试</title>
    <link rel="stylesheet" href="__LAYUI__/css/layui.css">
    <link rel="stylesheet" href="__TOASTR__/build/toastr.css">
    <style>
        .layui-layer-msg{
            display: none;
        }
        .layui-bank,.bankContent{
            display: none;
        }
        .bank li{
            float: left;
            width:120px;
            margin: 0 5px;
        }
    </style>
</head>
<body>
    <form class="layui-form" style="width: 95%;margin: 60px auto">
        <div class="layui-form-item">
            <label class="layui-form-label">支付金额</label>
            <div class="layui-input-block">
                <input type="number" class="layui-input" name="money" id="money" placeholder="写入支付金额" lay-verify="money" onkeyup="validationNumber( this, 2)">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">支付方式</label>
            <div class="layui-input-block">
                <select name="type" lay-verify="type" lay-filter="type">
                    <option value="0">-请选择支付方式-</option>
                    {volist name="way" id="w"}
                    <option value="{$w.id}">{$w.name}</option>
                    {/volist}
                </select>
            </div>
        </div>
        <div class="layui-form-item" id="moreType" style="display: none">
            <label class="layui-form-label">选择支付方式</label>
            <div class="layui-input-block">
            </div>
        </div>
        <div class="layui-form-item layui-bank">
            <span>请选择支付银行</span>
            <ul class="bank">
                <li>
                    <a href="#">
                        <input type="radio"  name="union" lay-verify="union" title="工商银行" value="工商银行" checked>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <input type="radio"  name="union" lay-verify="union" title="建设银行" value="建设银行">

                    </a>
                </li>
                <li>
                    <a href="#">
                        <input type="radio"  name="union" lay-verify="union" title="农业银行" value="建设银行">
                    </a>
                </li>
                <li>
                    <a href="#">
                        <input type="radio"  name="union" lay-verify="union" title="中国银行" value="建设银行">
                    </a>
                </li>
                <li>
                    <a href="#">
                        <input type="radio"  name="union" lay-verify="union" title="交通银行" value="建设银行">
                    </a>
                </li>
                <li>
                    <a href="#">
                        <input type="radio"  name="union" lay-verify="union" title="招商银行" value="建设银行">
                    </a>
                </li>
            </ul>
        </div>
        <div class="layui-form-item bankContent">
            <div class="layui-form-item">
                <label class="layui-form-label">开户人姓名：</label>
                <div class="layui-input-block">
                    <input type="text" name="name"  lay-verify="name" placeholder="请输入开户人姓名"  class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">银联卡号：</label>
                <div class="layui-input-block">
                    <input type="text" name="bank_code"   lay-verify="bank_code" placeholder="请输入银联卡号"  class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">银行预留手机号：</label>
                <div class="layui-input-block">
                    <input type="text" name="mobile"  lay-verify="mobile" placeholder="请输入手机号"  class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">身份证号码：</label>
                <div class="layui-input-block">
                    <input type="text" name="idCard"   lay-verify="idCard" placeholder="请输入身份证号码"  class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-card">
            <div class="layui-card-body" style="text-align: center">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <!--商户订单号-->
                <input type="hidden" name="payId" value="{:time()}">
                <button class="layui-btn submitBtn_add" lay-submit lay-filter="formDemo">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</body>
<script type="text/javascript" src="__JS__/jquery.js"></script>
<script type="text/javascript" src="__LAYUI__/layui.js"></script>
<script type="text/javascript" src="__TOASTR__/toastr.js"></script>
<script>
    function validationNumber(e, num) {
        var regu = /^[0-9]+\.?[0-9]*$/;
        if (e.value != "") {
            if (!regu.test(e.value)) {
                alert("请输入正确的数字");
                e.value = e.value.substring(0, e.value.length - 1);
                e.focus();
            } else {
                if (num == 0) {
                    if (e.value.indexOf('.') > -1) {
                        e.value = e.value.substring(0, e.value.length - 1);
                        e.focus();
                    }
                }
                if (e.value.indexOf('.') > -1) {
                    if (e.value.split('.')[1].length > num) {
                        e.value = e.value.substring(0, e.value.length - 1);
                        e.focus();
                    }
                }
            }
        }
    }

    layui.use(['form'], function() {
        var form = layui.form;
        var flag = true;
        //自定义验证规则
        form.verify({
            money: function(value) {
                if( value ===  "" ){
                    toastr.error( "请输入支付金额" );
                    return "请输入支付金额";
                }
            },
            type:function ( value ) {
                if( value === "0"){
                    toastr.error( "请选择支付方式" );
                    return "请选择支付方式";
                }else if(value === "10"){
                    form.verify({
                        name:function ( value ) {
                            if( value === ""){
                                toastr.error( "请输入开户人姓名" );
                                return "请输入开户人姓名";
                            }
                        },
                        bank_code:function ( value ) {
                            if( value === ""){
                                toastr.error( "请输入银行卡号" );
                                return "请输入银行卡号";
                            }
                        },
                        phone:function ( value ) {
                            if( value === ""){
                                toastr.error( "请输入银行预留手机号" );
                                return "请输入银行预留手机号";
                            }
                        },
                        idCard:function ( value ) {
                            if( value === ""){
                                toastr.error( "请输入身份证号码" );
                                return "请输入身份证号码";
                            }
                        }
                    })
                }
            },

        });
        form.on('select(type)', function(data){

            if(data.value == 10){
                $(".layui-bank").show();
                $(".bankContent").show();
            }else{
                $(".layui-bank").hide();
                $(".bankContent").hide();
            }
            $.post( "{:url('freeList')}",{id:data.value},function (res) {
                if( res.code === 1 ){
                    $('#moreType').show().find('.layui-input-block').html( res.msg );
                    form.render();
                } else {
                    $('#moreType').hide();
                }
            })
        });
        form.on('radio(randM)', function(data){
            console.log( data.elem.dataset.price )
            if( data.value === "0" ){
                $('#money').attr( 'readonly', false);
            } else {
                var price = data.elem.dataset.price;
                $('#money').attr( 'readonly', true).val( price );
            }
        });
        form.on('submit(formDemo)', function(data){
            $.post('',data.field,function (res) {
                console.log( res )
                if( res.code === 1 ){
                    $('.layui-card-body').html( res.data );
                } else {
                    toastr.error( res.msg )
                }
            })
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
    });
</script>
</html>