<?php
/**
 * Created by PhpStorm.
 * User: Administrator
 * Date: 2019/6/19 0019
 * Time: 15:23
 */

namespace app\business\controller;
use app\common\controller\Business;

class User extends Business
{
    public function _initialize()
    {
        parent::_initialize(); // TODO: Change the autogenerated stub
        $this->table = "business";
        $this->model = model( "business");
    }

    /**
     * 2019/6/19 0019 15:24
     * @desc 商户基本信息
     * @ApiParams
     * @ApiReturnParams
     */
    public function profile()
    {
        return $this->fetch();
    }

    /**
     * 2019/6/26 0026 15:01
     * @desc获取通道列表
     * @ApiParams
     * @ApiReturnParams
     */
    public function passageway()
    {
        if($this->request->isPost() && $this->request->isAjax()){
            $list = model('manage/user_passageway')
                ->alias('user')
                ->where('business_id','=',$this->user->id)
                ->join(config('database.prefix').'passageway b','user.passageway_id = b.id')
                ->select();
            $count = model('manage/user_passageway')
                ->alias('user')
                ->where('business_id','=',$this->user->id)
                ->join(config('database.prefix').'passageway b','user.passageway_id = b.id')
                ->count();
            $data = [
                'list' => $list,
                'count' => $count,
            ];
            $this->success('',null,$data);
        }
        return $this->fetch();
    }
}